<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çağan XOX | Pro Star Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --neon-pink: #FF6AC1;
            --neon-blue: #00FFFF;
            --neon-green: #7FFF00;
            --main-orange: #FFA500;
        }

        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }

        body {
            margin: 0; min-height: 100vh; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: radial-gradient(circle at center, #0f0c29, #302b63, #24243e);
            color: white; overflow: hidden;
        }

        body::before {
            content: ""; position: absolute; width: 100%; height: 100%;
            background-image: radial-gradient(white, rgba(255,255,255,.05) 1px, transparent 15px);
            background-size: 250px 250px; z-index: -1;
        }

        #capture-area {
            padding: 30px; background: rgba(0, 0, 0, 0.5); border-radius: 25px;
            backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center; margin-bottom: 10px;
        }

        #main-title { font-size: 3.5em; color: var(--main-orange); text-shadow: 0 0 15px var(--main-orange); margin: 0; }

        .score-board {
            display: flex; justify-content: center; gap: 30px; margin-bottom: 10px;
            font-size: 1.1em; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;
        }
        .score-val { font-size: 1.4em; color: var(--neon-green); display: block; }
        
        .active-player-x {
            color: var(--neon-pink) !important;
            text-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink);
            transition: 0.5s;
        }
        .active-player-o {
            color: var(--neon-blue) !important;
            text-shadow: 0 0 20px var(--neon-blue), 0 0 40px var(--neon-blue);
            transition: 0.5s;
        }

        .target-info { font-size: 0.8em; color: var(--main-orange); margin-top: 5px; }
        #game-status { font-size: 1.5em; color: var(--neon-blue); margin: 15px 0; height: 1.5em; font-weight: bold; }

        #board {
            display: grid; grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px); gap: 12px;
            background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 20px;
        }

        .cell {
            background: rgba(46, 26, 71, 0.8); border-radius: 12px; display: flex;
            align-items: center; justify-content: center; font-size: 3.5em;
            font-weight: bold; cursor: pointer; transition: 0.3s; width: 100px; height: 100px;
        }

        .cell.x { color: var(--neon-pink); text-shadow: 0 0 15px var(--neon-pink); }
        .cell.o { color: var(--neon-blue); text-shadow: 0 0 15px var(--neon-blue); }
        .winning-cell { background: var(--neon-green) !important; color: black !important; box-shadow: 0 0 30px var(--neon-green); }

        .game-btn {
            padding: 12px 25px; background: transparent; color: var(--neon-blue);
            border: 2px solid var(--neon-blue); border-radius: 10px; cursor: pointer;
            font-weight: bold; text-transform: uppercase; margin-top: 20px;
        }

        .top-controls { position: absolute; top: 20px; right: 20px; display: flex; gap: 20px; align-items: center; z-index: 3000; }
        .icon-btn { font-size: 2.2em; background: none; border: none; color: var(--neon-blue); cursor: pointer; transition: 0.3s; }

        #settings-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 4000; }
        .settings-content { background: #1a1a2e; padding: 30px; border-radius: 20px; border: 2px solid var(--neon-blue); width: 300px; text-align: center; }
        
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--neon-green); }
        input:checked + .slider:before { transform: translateX(26px); }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: #1a1a2e; padding: 40px; border-radius: 30px; border: 2px solid var(--neon-blue); text-align: center; width: 90%; max-width: 400px; }
        input[type="text"] { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid var(--neon-blue); color: white; border-radius: 8px; text-align: center; }
        .diff-container { display: flex; justify-content: space-around; margin: 20px 0; }
        .diff-opt { padding: 8px 12px; border: 1px solid #444; border-radius: 8px; cursor: pointer; font-size: 0.8em; }
        .diff-opt.active { background: var(--neon-pink); color: black; font-weight: bold; }
        .hidden { display: none !important; }

        /* COPYRIGHT STİLİ */
        .footer-text {
            margin-top: 30px; font-size: 0.9em; color: rgba(255, 255, 255, 0.4);
            letter-spacing: 1px; text-transform: uppercase; font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="https://cdn.pixabay.com/audio/2022/03/15/audio_730623a6c1.mp3"></audio>
    <audio id="click-sound"><source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"></audio>
    <audio id="firework-sound"><source src="https://assets.mixkit.co/active_storage/sfx/1998/1998-preview.mp3"></audio>

    <div class="top-controls">
        <button class="icon-btn" onclick="location.reload()">☰</button>
        <button class="icon-btn" onclick="toggleSettings()">⚙</button>
    </div>

    <div id="settings-modal">
        <div class="settings-content">
            <h3 style="color: var(--neon-blue);">AYARLAR</h3>
            <div style="display:flex; justify-content:space-between; align-items:center; margin:20px 0; color:white;">
                <span>Müzik / Ses</span>
                <label class="switch">
                    <input type="checkbox" id="music-toggle" onchange="handleMusicToggle(this)">
                    <span class="slider"></span>
                </label>
            </div>
            <button class="game-btn" onclick="toggleSettings()">KAPAT</button>
        </div>
    </div>

    <div id="main-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--neon-blue)">ÇAĞAN XOX</h2>
            <div id="step-1">
                <button class="game-btn" style="width:100%" onclick="setupStep2(false)">BOT'A KARŞI</button>
                <button class="game-btn" style="width:100%" onclick="setupStep2(true)">İKİ OYUNCU</button>
            </div>
            <div id="step-2" class="hidden">
                <input type="text" id="p1-in" placeholder="1. Oyuncu Adı">
                <input type="text" id="p2-in" placeholder="2. Oyuncu Adı" class="hidden">
                <div id="diff-box">
                    <div class="diff-container">
                        <span class="diff-opt" onclick="setDiff('easy', this)">KOLAY</span>
                        <span class="diff-opt active" onclick="setDiff('medium', this)">ORTA</span>
                        <span class="diff-opt" onclick="setDiff('hard', this)">ZOR</span>
                    </div>
                </div>
                <button class="game-btn" style="width:100%; border-color:var(--neon-green); color:var(--neon-green)" onclick="startGame()">BAŞLAT</button>
            </div>
        </div>
    </div>

    <div id="capture-area">
        <h1 id="main-title">ÇAĞAN XOX</h1>
        
        <div class="score-board">
            <div id="box-x"><span id="name-x">X</span><span id="score-x" class="score-val">0</span></div>
            <div><span>BERABERE</span><span id="score-draw" class="score-val">0</span></div>
            <div id="box-o"><span id="name-o">O</span><span id="score-o" class="score-val">0</span></div>
        </div>
        <div class="target-info">İLK 3 OLAN KAZANIR!</div>

        <div id="game-status">Yükleniyor...</div>
        <div id="board">
            <div class="cell" data-index="0"></div><div class="cell" data-index="1"></div><div class="cell" data-index="2"></div>
            <div class="cell" data-index="3"></div><div class="cell" data-index="4"></div><div class="cell" data-index="5"></div>
            <div class="cell" data-index="6"></div><div class="cell" data-index="7"></div><div class="cell" data-index="8"></div>
        </div>
    </div>

    <div style="display:flex; gap:10px">
        <button id="reset-btn" class="game-btn" onclick="resetGame()">TEKRARLA</button>
        <button id="new-series-btn" class="game-btn hidden" onclick="location.reload()">YENİ SERİ BAŞLAT</button>
        <button id="save-btn" class="game-btn hidden" onclick="downloadImg()">SKORU KAYDET</button>
    </div>

    <div class="footer-text">Copyright Çağan Yeşilyurt 2025</div>

    <script>
        let board = ["", "", "", "", "", "", "", "", ""];
        let currentPlayer = "X";
        let gameActive = false;
        let isPVP = false;
        let difficulty = "medium";
        let names = { X: "X", O: "O" };
        let scores = { X: 0, O: 0, draw: 0 };
        let seriesWinnerFound = false;
        let audioEnabled = false;

        const bgMusic = document.getElementById('bg-music');
        const clickSound = document.getElementById('click-sound');
        const fireworkSound = document.getElementById('firework-sound');

        function toggleSettings() {
            const m = document.getElementById('settings-modal');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }

        function handleMusicToggle(chk) {
            audioEnabled = chk.checked;
            if (audioEnabled) { bgMusic.volume = 0.15; bgMusic.play(); } else { bgMusic.pause(); }
        }

        function setupStep2(pvp) {
            isPVP = pvp;
            document.getElementById('step-1').classList.add('hidden');
            document.getElementById('step-2').classList.remove('hidden');
            document.getElementById('p2-in').classList.toggle('hidden', !pvp);
            document.getElementById('diff-box').classList.toggle('hidden', pvp);
        }

        function setDiff(d, el) {
            difficulty = d;
            document.querySelectorAll('.diff-opt').forEach(x => x.classList.remove('active'));
            el.classList.add('active');
        }

        function startGame() {
            names.X = document.getElementById('p1-in').value || "Oyuncu 1";
            names.O = isPVP ? (document.getElementById('p2-in').value || "Oyuncu 2") : "Bot";
            document.getElementById('name-x').innerText = names.X;
            document.getElementById('name-o').innerText = names.O;
            document.getElementById('main-modal').classList.add('hidden');
            resetGame();
        }

        function handleCellClick(e) {
            if (!gameActive || seriesWinnerFound) return;
            const idx = e.target.dataset.index;
            if (board[idx] !== "") return;
            if (!isPVP && currentPlayer === "O") return;

            if (audioEnabled) { clickSound.currentTime = 0; clickSound.play(); }
            executeMove(idx, currentPlayer);

            if (gameActive) {
                if (!isPVP) {
                    currentPlayer = "O";
                    updateStatusText();
                    setTimeout(botAction, 600);
                } else {
                    currentPlayer = (currentPlayer === "X") ? "O" : "X";
                    updateStatusText();
                }
            }
        }

        function executeMove(idx, symbol) {
            board[idx] = symbol;
            const cell = document.querySelector(`[data-index="${idx}"]`);
            cell.innerText = symbol;
            cell.classList.add(symbol.toLowerCase());
            checkWinner();
        }

        function botAction() {
            if (!gameActive || seriesWinnerFound) return;
            let move = minimax(board, "O").index;
            if (difficulty === "medium" && Math.random() < 0.4) move = randomMove();
            if (difficulty === "easy" && Math.random() < 0.7) move = randomMove();
            
            if (audioEnabled) { clickSound.currentTime = 0; clickSound.play(); }
            executeMove(move, "O");
            if (gameActive) { currentPlayer = "X"; updateStatusText(); }
        }

        function randomMove() {
            const avail = board.map((v, i) => v === "" ? i : null).filter(v => v !== null);
            return avail[Math.floor(Math.random() * avail.length)];
        }

        function minimax(newBoard, player) {
            const avail = newBoard.map((v, i) => v === "" ? i : null).filter(v => v !== null);
            if (checkWinMatch(newBoard, "X")) return { score: -10 };
            if (checkWinMatch(newBoard, "O")) return { score: 10 };
            if (avail.length === 0) return { score: 0 };

            const moves = [];
            for (let i = 0; i < avail.length; i++) {
                let move = { index: avail[i] };
                newBoard[avail[i]] = player;
                move.score = minimax(newBoard, player === "O" ? "X" : "O").score;
                newBoard[avail[i]] = "";
                moves.push(move);
            }

            let bestMove;
            if (player === "O") {
                let bestScore = -10000;
                for (let i = 0; i < moves.length; i++) { if (moves[i].score > bestScore) { bestScore = moves[i].score; bestMove = i; } }
            } else {
                let bestScore = 10000;
                for (let i = 0; i < moves.length; i++) { if (moves[i].score < bestScore) { bestScore = moves[i].score; bestMove = i; } }
            }
            return moves[bestMove];
        }

        function checkWinMatch(b, p) {
            const w = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return w.some(s => b[s[0]] === p && b[s[1]] === p && b[s[2]] === p);
        }

        function checkWinner() {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            let found = false;
            for (let s of wins) {
                if (board[s[0]] && board[s[0]] === board[s[1]] && board[s[0]] === board[s[2]]) {
                    const winSym = board[s[0]];
                    s.forEach(i => document.querySelector(`[data-index="${i}"]`).classList.add('winning-cell'));
                    gameActive = false;
                    scores[winSym]++;
                    updateScores();
                    
                    if (scores[winSym] === 3) {
                        finalizeSeries(names[winSym]);
                    } else {
                        document.getElementById('game-status').innerText = names[winSym] + " KAZANDI!";
                        document.getElementById('save-btn').classList.remove('hidden');
                        celebrate(false);
                    }
                    found = true; break;
                }
            }
            if (!found && !board.includes("")) { 
                document.getElementById('game-status').innerText = "BERABERE!"; 
                gameActive = false; 
                scores.draw++;
                updateScores();
                document.getElementById('save-btn').classList.remove('hidden'); 
            }
        }

        function finalizeSeries(winnerName) {
            seriesWinnerFound = true;
            document.getElementById('game-status').style.color = 'var(--neon-green)';
            document.getElementById('game-status').innerText = "TEBRİKLER " + winnerName.toUpperCase() + " OYUNU KAZANDIN!";
            document.getElementById('reset-btn').classList.add('hidden');
            document.getElementById('new-series-btn').classList.remove('hidden');
            document.getElementById('save-btn').classList.remove('hidden');
            celebrate(true);
        }

        function updateScores() {
            document.getElementById('score-x').innerText = scores.X;
            document.getElementById('score-o').innerText = scores.O;
            document.getElementById('score-draw').innerText = scores.draw;
        }

        function celebrate(isLong) {
            if (audioEnabled) { fireworkSound.currentTime = 0; fireworkSound.play(); }
            let end = Date.now() + (isLong ? 5000 : 1500);
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#FF6AC1', '#00FFFF', '#7FFF00'] });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#FF6AC1', '#00FFFF', '#7FFF00'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        function updateStatusText() { 
            if (gameActive) {
                document.getElementById('game-status').innerText = "SIRA: " + names[currentPlayer];
                if (currentPlayer === "X") {
                    document.getElementById('box-x').classList.add('active-player-x');
                    document.getElementById('box-o').classList.remove('active-player-o');
                } else {
                    document.getElementById('box-o').classList.add('active-player-o');
                    document.getElementById('box-x').classList.remove('active-player-x');
                }
            } else {
                document.getElementById('box-x').classList.remove('active-player-x');
                document.getElementById('box-o').classList.remove('active-player-o');
            }
        }

        function resetGame() {
            if (seriesWinnerFound) return;
            board = ["", "", "", "", "", "", "", "", ""]; currentPlayer = "X"; gameActive = true;
            document.getElementById('save-btn').classList.add('hidden');
            document.querySelectorAll('.cell').forEach(c => { c.innerText = ""; c.className = "cell"; });
            updateStatusText();
        }

        function downloadImg() {
            html2canvas(document.getElementById('capture-area')).then(canvas => {
                const a = document.createElement('a');
                a.download = 'CAGAN_XOX_SKOR.png';
                a.href = canvas.toDataURL();
                a.click();
            });
        }

        document.querySelectorAll('.cell').forEach(c => c.addEventListener('click', handleCellClick));
    </script>
</body>
</html>
